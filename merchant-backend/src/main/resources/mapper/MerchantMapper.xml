<?xml version="1.0" encoding="UTF-8" ?>
<!-- MyBatis的DTD约束，固定写法，用于校验XML语法 -->
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.example.merchantbackend.mapper.MerchantMapper">

<!--    申请为商家-->
        <insert id="applyMerchant" parameterType="org.example.merchantbackend.entity.Merchant">
            INSERT INTO merchant
            <trim prefix="(" suffix=")" suffixOverrides=",">
                <!-- 必须字段 -->
                    user_id,
                    merchant_type,
                    merchant_name,
                    contact_name,
                    contact_phone,
                    contact_email,
                    business_license,
                    id_card,
                <if test="LicenseImage != null and LicenseImage != ''">
                    license_image,
                </if>
                <if test="idCardFront != null and idCardFront != ''">
                    id_card_front,
                </if>
                <if test="idCardBack != null and idCardBack != ''">
                    id_card_back,
                </if>

                <!-- 系统自动设置的字段 -->
                status,
                is_deleted,
                create_time,
                update_time
            </trim>
            <trim prefix="VALUES (" suffix=")" suffixOverrides=",">
                <!-- 必须字段 -->
                    #{UserId},
                    #{merchantType},
                    #{merchantName},
                    #{contactName},
                    #{contactPhone},
                    #{contactEmail},
                    #{businessLicense},
                    #{idCard},
                <if test="LicenseImage != null and LicenseImage != ''">
                    #{LicenseImage},
                </if>
                <if test="idCardFront != null and idCardFront != ''">
                    #{idCardFront},
                </if>
                <if test="idCardBack != null and idCardBack != ''">
                    #{idCardBack},
                </if>

                <!-- 系统自动设置的字段 -->
                0, <!-- 默认审核状态：待审核 -->
                0, <!-- is_deleted 默认为 0（未删除） -->
                NOW(), <!-- 创建时间 -->
                NOW() <!-- 更新时间 -->
            </trim>
        </insert>

<!--    修改商家信息-->
    <update id="updateMerchant">
       UPDATE merchant
       <trim prefix="SET" suffixOverrides="," prefixOverrides=",">
           <if test="merchantType != null and merchantType != ''">merchant_type = #{merchantType},</if>
           <if test="merchantName != null and merchantName != ''">merchant_name = #{merchantName},</if>
           <if test="contactName != null and contactName != ''">contact_name = #{contactName},</if>
           <if test="contactPhone != null and contactPhone != ''">contact_phone = #{contactPhone},</if>
           <if test="contactEmail != null and contactEmail != ''">contact_email = #{contactEmail},</if>
           <if test="businessLicense != null and businessLicense != ''">business_license = #{businessLicense},</if>
           <if test="LicenseImage != null and LicenseImage != ''">license_image = #{LicenseImage},</if>
           <if test="idCard != null and idCard != ''">id_card = #{idCard},</if>
           <if test="idCardFront != null and idCardFront != ''">id_card_front = #{idCardFront},</if>
           <if test="idCardBack != null and idCardBack != ''">id_card_back = #{idCardBack},</if>
           <if test="status != null and status != ''">status = #{status},</if>
           <if test="rejectReason != null and rejectReason != ''">reject_reason = #{rejectReason},</if>
           <if test="auditTime != null and auditTime != ''">audit_time = #{auditTime},</if>
           <if test="auditor != null and auditor != ''">auditor = #{auditor},</if>
           <if test="isDeleted != null">is_deleted = #{isDeleted},</if>
           <if test="updateTime != null and updateTime != ''">update_time = #{updateTime,jdbcType=TIMESTAMP},</if>
       </trim>
       WHERE id = #{id} and user_id = #{userId}
    </update>

      <!--    查询商家信息-->
    <select id="selectMerchants" resultType="org.example.merchantbackend.entity.Merchant">
            SELECT * FROM merchant where 1=1
            <if test="id !=null and id != ''">and id = #{id}</if>
            <if test="userId !=null and userId != ''">and user_id = #{userId}</if>
            <if test="merchantName !=null and merchantName != ''">and merchant_name like concat('%',#{merchantName},'%')</if>
            <if test="contactName !=null and contactName != ''">and contact_name like concat('%',#{contactName},'%')</if>
            <if test="contactPhone !=null and contactPhone != ''">and contact_phone like concat('%',#{contactPhone},'%')</if>
            <if test="contactEmail !=null and contactEmail != ''">and contact_email like concat('%',#{contactEmail},'%')</if>
            <if test="businessLicense !=null and businessLicense != ''">and business_license like concat('%',#{businessLicense},'%')</if>
            <if test="status !=null and status != ''">and status = #{status}</if>
            <if test="auditTime !=null and auditTime != ''">and audit_time = #{auditTime}</if>
            <if test="auditor !=null and auditor != ''">and auditor = #{auditor}</if>
            <if test="isDeleted !=null and isDeleted != ''">and is_deleted = #{isDeleted}</if>
            <if test="createTime !=null and createTime != ''">and create_time = #{createTime}</if>
            <if test="updateTime !=null and updateTime != ''">and update_time = #{updateTime}</if>
            order by create_time desc
    </select>

</mapper>